#textdomain wesnoth-GambCiv

[event]
  name = preload
  first_time_only = no
  [lua]
    code = << wesnoth.require("~/add-ons/GambCiv/utils/rand_range.lua") >>
  [/lua]
[/event]

#A special shortcut to [terrain].
#define SEASON_TERRAIN TERRAIN LAYER FILTER
  [terrain]
    terrain = {TERRAIN}
    layer = {LAYER}
    [and]
      terrain = {FILTER}
    [/and]
  [/terrain]
#enddef

#Switch seasons every X turns.
[event]
  name = new turn
  first_time_only = no
  [filter_condition]
    {VARCH GambCiv_disable_seasons not_equals "yes"}
    {VARCH turn_number equals $next_season_turn}
  [/filter_condition]

  [switch]
    variable = season
    [case]
      value = "winter"
      [fire_event]
	name = spring
      [/fire_event]
    [/case]
    [case]
      value = "spring"
      [fire_event]
	name = winter
      [/fire_event]
    [/case]
  [/switch]
[/event]

#Put snow everywhere and tell the game to switch to spring in 10 to 14 turns
[event]
  name = winter
  first_time_only = no

  {VARIABLE season "winter"}
  [print]
    text = _ "WINTER"
    size = 24
    duration = 40
    red,green,blue = 255,255,255
  [/print]
  [rand_range]
    variable = next_season_turn
    lower = 10
    upper = 14
  [/rand_range]
  {VARIABLE_OP next_season_turn add $turn_number}
  {VARIABLE_OP next_season_turn add -1}
[/event]

#Every turn of winter, randomly snow a bit
[event]
  name = new turn
  first_time_only = no
  [filter_condition]
    {VARCH season equals "winter"}
  [/filter_condition]

  [lua]
    code = << wesnoth.require("~/add-ons/GambCiv/utils/snow.lua") >>
  [/lua]
[/event]

#Melt the snow, grow the forests, and tell the game to switch to winter in 13 to 17 turns
[event]
  name = spring
  first_time_only = no

  {VARIABLE season "spring"}
  [print]
    text = _ "SPRING"
    size = 24
    duration = 40
    red,green,blue = 200,50,50
  [/print]
  {SEASON_TERRAIN Ww both Ai}
  {SEASON_TERRAIN Gg base Aa^*}
  {SEASON_TERRAIN Hh base Ha^*}
  {SEASON_TERRAIN Mm base Ms^*}
  {SEASON_TERRAIN ^Fp overlay *^Fpa}
  [terrain]
    terrain = ^Fp
    layer = overlay
    [and]
      terrain = G*,H*
      [and]
	radius = 1
	terrain = *^F*
      [/and]
    [/and]
  [/terrain]
  [rand_range]
    variable = next_season_turn
    lower = 13
    upper = 17
  [/rand_range]
  {VARIABLE_OP next_season_turn add $turn_number}
  {VARIABLE_OP next_season_turn add -1}
[/event]
