[event]
  name = side turn 1
  first_time_only = no
  [get_global_variable]
    namespace = gambciv.stats
    from_global = times_played
    to_local = times_played_$side_number
    side = $side_number
  [/get_global_variable]

  [lua]
    code = <<

      if(wesnoth.get_variable("side_number") == 1) then
	perm_table = wesnoth.get_variable("times_played_1")
	if(perm_table == "") then
	  perm_table = {}
	end
      end

      temp_table = wesnoth.get_variable("times_played_" .. wesnoth.get_variable("side_number"))
      if(temp_table == "") then
	temp_table = {}
      end

      for username,plays in pairs(temp_table) do
	if(plays > perm_table[username]) then
	  perm_table[username] = plays
	end
      end
    >>
  [/lua]
[/event]

[event]
  name = side turn 2

  [lua]
    code = <<
      for id,side in pairs(wesnoth.sides) do
	if(side.controller == "human") then
	  if(perm_table[side.name] == nil) then
	    perm_table[side.name] = 1
	  else
	    perm_table[side.name] = perm_table[side.name] + 1
	  end
	end
      end

      wesnoth.set_variable("times_played",perm_table)
    >>
  [/lua]
  [set_global_variable]
    namespace = gambciv.stats
    from_local = times_played
    to_global = times_played
    side = global
    immediate = yes
  [/set_global_variable]
[/event]